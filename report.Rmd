---
title: "Report: Australian Census Data"
subtitle: "ETC5513 Assignment 4: Star Wars"
author:
- familyname: Faizan
  othernames: Mohammed
  address: Monash University
  email: mfai0014@student.monash.edu
  correspondingauthor: true
  qualifications:  MBAt
- familyname: More
  othernames: Adarsh
  address: Monash University
  email: amor0060@student.monash.edu
  qualifications: MBAt
- familyname: LI
  othernames: Yanhui
  address: Monash University
  email: yli807@student.monash.edu
  correspondingauthor: true
  qualifications:  MBAt
department: Our consultancy - Star Wars\newline Mohammed Faizan &\newline Adarsh More&\newline Yanhui LI
organization: Monash University
bibliography: 
- references.bib
- packages.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: true
keep_md: true
---

```{r echo=FALSE, include=FALSE}
knitr::opts_chunk$set(fig.path = "Figures/", fig.align ="center",
                      out.width = "50%", echo = FALSE, 
                      messages = FALSE, 
                      warning = FALSE)

# Loading Libraries
library(tidyverse)
library(readr)
library(kableExtra)
library(tinytex)
library(bookdown)
library(naniar)
library(visdat)
library(citation)
library(knitr)
library(scales)
library(patchwork)
library(sf)
library(glue)
library(unglue)
library(sugarbag)
library(readxl)
```

```{r writing_packages_bibliographies}
knitr::write_bib(c(.packages()), "packages.bib")
```

```{r}
celldescriptors <- read_excel(here::here("data/australian_census_data_2016/Metadata/Metadata_2016_GCP_DataPack.xlsx"),sheet=2, skip=10)
```


```{r}
data_path <- here::here("data/australian_census_data_2016/")

census_paths <- glue::glue(data_path, "2016 Census GCP All Geographies for VIC/SA4/VIC/2016Census_G{number}{alpha}_VIC_SA4.csv", 
                         number = c("46","46","47","47","47"), 
                         alpha = c("A","B","A","B","C"))
```


```{r geopath, include=FALSE}
geopath <- glue::glue(data_path, "2016_SA4_shape/SA4_2016_AUST.shp")

sa4_codes<- read_csv(census_paths[2]) %>% 
                mutate(SA4_CODE_2016 = as.character(SA4_CODE_2016)) %>% 
                select(SA4_CODE_2016)


sa4_geomap <- read_sf(geopath) %>%
  right_join(sa4_codes, by=c("SA4_CODE16" = "SA4_CODE_2016"))
```

```{r}
ggplot(sa4_geomap) +
  geom_sf()
```

```{r g46read, include=FALSE}
g46a<- read_csv(census_paths[1]) %>%
  select(-starts_with("P"), -contains("Tot"), -contains("nfd"), -contains("IDes")) %>%
            mutate(SA4_CODE_2016 = as.character(SA4_CODE_2016)) %>% 
  pivot_longer(cols = -c(SA4_CODE_2016),
                  names_to = "category",
                  values_to = "count") %>%
  unglue_unnest(category, 
                    c("{sex=[MF]}_{educationlevel=GradDip_and_GradCert}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=PGrad_Deg}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=BachDeg}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=AdvDip_and_Dip}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=Cert_III_IV}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=Cert_I_II}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=Lev_Edu_NS}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{educationlevel=Lev_Edu_NS|GradDip_and_GradCert|PGrad_Deg|BachDeg|AdvDip_and_Dip|Cert_III_IV|Cert_I_II}_{age_min=\\d+}ov"
                      
                      ),
                remove = FALSE) %>% 
  select(-category)
  
```

```{r}
g46a <- g46a %>% 
  mutate(afq_level =case_when(str_detect(educationlevel, "GradDip_and_GradCert") ~ "Level 8",
                            str_detect(educationlevel, "PGrad") ~ "Level 9",
                            str_detect(educationlevel, "BachDeg") ~ "Level 7",
                            str_detect(educationlevel, "AdvDip_and_Dip") ~ "Level 5 & 6",
                            str_detect(educationlevel, "Cert_III_IV") ~ "Level 3 & 4",
                            str_detect(educationlevel, "Cert_I_II") ~ "Level 1 & 2",
                            str_detect(educationlevel, "Cert_Levl_nfd") ~ "Level 3 & 4",
                            str_detect(educationlevel, "Lev_Edu_IDes") ~ "Level Inadequately Described",
                            str_detect(educationlevel, "Lev_Edu_NS") ~ "Not Stated",
                            TRUE ~ educationlevel)) %>% 
  rename(count_edu_lvl = count)
```

```{r}
g47 <- map_dfr(census_paths[3:4], ~{
  df <- read_csv(.x) %>%
      select(-starts_with("P"), -contains("Tot"), -contains("InadDes")) %>%
            mutate(SA4_CODE_2016 = as.character(SA4_CODE_2016)) %>% 
  pivot_longer(cols = -c(SA4_CODE_2016),
                  names_to = "category",
                  values_to = "count") %>%
  unglue_unnest(category, 
                    c("{sex=[MF]}_{field=(Mgnt_Com|Society_Cult|Fd_Hosp_Psnl_Svcs|MixFld_Prgm|FldStd_NS|NatPhyl_Scn|InfoTech|Eng_RelTec|ArchtBldng|Ag_Envir_Rltd_Sts|Health|Educ|Creative_Arts)}_{age_min=\\d+}_{age_max=\\d+}",
                      "{sex=[MF]}_{field=(Mgnt_Com|Society_Cult|Fd_Hosp_Psnl_Svcs|MixFld_Prgm|FldStd_NS|NatPhyl_Scn|InfoTech|Eng_RelTec|ArchtBldng|Ag_Envir_Rltd_Sts|Health|Educ|Creative_Arts)}_{age_min=\\d+}ov",
                      "{sex=[MF]}_{field=(Mgnt_Com|Society_Cult|Fd_Hosp_Psnl_Svcs|MixFld_Prgm|FldStd_NS|NatPhyl_Scn|InfoTech|Eng_RelTec|ArchtBldng|Ag_Envir_Rltd_Sts|Health|Educ|Creative_Arts)}_{age_min=\\d+}_years_and_over"
                      
                      ),
                remove = FALSE)
})

```
```{r}
g47 <- g47 %>% 
  mutate(field =case_when(
    str_detect(field, "NatPhyl_Scn") ~ "Natural_and_Physical_Sciences",
                            str_detect(field, "InfoTech") ~ "Information_Technology",
                            str_detect(field, "Eng_RelTec") ~ "Engineering_and_Technologies",
                            str_detect(field, "ArchtBldng") ~ "Architecture_and_Building",
                            str_detect(field, "Ag_Envir_Rltd_Sts") ~ "Agriculture_Environment",
                            str_detect(field, "Health") ~ "Health",
                            str_detect(field, "Educ") ~ "Education",
                            str_detect(field, "Mgnt_Com") ~ "Management_and_Commerce",
                            str_detect(field, "Society_Cult") ~ "Society_and_Culture",
                            str_detect(field, "Creative_Arts") ~ "Creative_Arts",
                            str_detect(field, "Fd_Hosp_Psnl_Svcs") ~ "Food_Hospitality_and_Personal_Services",str_detect(field, "MixFld_Prgm") ~ "Mixed_Field_Programmes",
                            str_detect(field, "FldStd_NS") ~ "Not Stated",
                            TRUE ~ field))  %>%
  select(-category) %>%
  rename(count_field = count)

```
